<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>UI Consistency Investigator - Settings</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <main class="wrap">
      <header class="hero">
        <img class="hero-logo" src="../../assets/icons/icon-128.png" alt="UI Consistency Investigator logo" />
        <div>
          <p class="eyebrow">Config Studio</p>
          <h1>UI Consistency Investigator</h1>
          <p>
            Configure scan depth, rule families, thresholds, auto-fix behavior, and custom rule logic.
          </p>
        </div>
      </header>

      <section class="panel">
        <h2 data-tip-target="true" data-tip="Control what gets scanned and how aggressively the engine samples and re-scans.">Scanning Scope</h2>
        <p class="section-help">
          Define where scans run and how expensive they can be. Use smaller limits for very large pages and enable auto-rescan when you want live diagnostics after responsive layout changes.
        </p>

        <label data-tip="CSS selector list for all elements that should be scanned.">
          Include selectors
          <textarea id="includeSelectors" rows="3"></textarea>
        </label>

        <label data-tip="Selectors that should be excluded from analysis.">
          Exclude selectors
          <textarea id="excludeSelectors" rows="3"></textarea>
        </label>

        <div class="grid4">
          <label data-tip="Ignore tiny elements under this rendered area.">Min element area (px2)<input id="minElementArea" type="number" min="1" /></label>
          <label data-tip="Minimum peer count required for group-based consistency checks.">Min group size<input id="minGroupSize" type="number" min="2" /></label>
          <label data-tip="Global cap for elements scanned per run.">Max elements per scan<input id="maxElements" type="number" min="50" /></label>
          <label data-tip="How many elements to include in overlap/collision checks.">Overlap sample limit<input id="overlapSampleLimit" type="number" min="50" /></label>
          <label data-tip="Hard cap for pairwise overlap comparisons.">Max overlap comparisons<input id="maxOverlapChecks" type="number" min="100" /></label>
          <label data-tip="Automatically rescan and rerender results when viewport size changes."><input id="autoRescanOnResize" type="checkbox" /> Auto-rescan on resize</label>
          <label data-tip="Debounce delay before re-running scans after resize.">Resize rescan debounce ms<input id="autoRescanDebounceMs" type="number" min="50" step="10" /></label>
        </div>

        <div class="checks">
          <label data-tip="Trace matching stylesheet rules for finding source hints."><input id="traceCSS" type="checkbox" /> Trace CSS source hints</label>
          <label data-tip="Include text-heavy nodes that are not strict controls/components."><input id="includeTextNodes" type="checkbox" /> Include text-heavy nodes</label>
        </div>
      </section>

      <section class="panel">
        <h2 data-tip-target="true" data-tip="Controls how similar elements are grouped for peer comparison.">Grouping Strategy</h2>
        <p class="section-help">
          Grouping determines which elements are compared to each other. If findings feel noisy, tighten grouping with class fingerprints; if you miss drift, loosen grouping dimensions.
        </p>

        <div class="checks">
          <label data-tip="Use tag name (button, input, div) as part of grouping key."><input id="useTag" type="checkbox" /> Group by tag name</label>
          <label data-tip="Use role attributes in grouping key."><input id="useRole" type="checkbox" /> Group by ARIA role</label>
          <label data-tip="Use stable class tokens in grouping key."><input id="useClassFingerprint" type="checkbox" /> Group by class fingerprint</label>
        </div>

        <label data-tip="Number of class tokens used per element for fingerprinting.">
          Class fingerprint depth
          <input id="classFingerprintDepth" type="number" min="1" max="5" />
        </label>
      </section>

      <section class="panel">
        <h2 data-tip-target="true" data-tip="Enable or disable entire families of scanning rules.">Rule Families</h2>
        <p class="section-help">
          Start broad for discovery, then disable families that are irrelevant for your product. Keep custom rules on for team-specific constraints.
        </p>

        <div class="checks multi">
          <label data-tip="Compare per-side padding values across peers."><input id="checkPadding" type="checkbox" /> Padding consistency</label>
          <label data-tip="Compare per-side margin values across peers."><input id="checkMargin" type="checkbox" /> Margin consistency</label>
          <label data-tip="Compare font-family/size/line-height/letter-spacing."><input id="checkTypography" type="checkbox" /> Typography consistency</label>
          <label data-tip="Check text and background palette drift."><input id="checkColors" type="checkbox" /> Color consistency</label>
          <label data-tip="Compare border radius consistency."><input id="checkBorderRadius" type="checkbox" /> Border radius consistency</label>
          <label data-tip="Compare border width consistency."><input id="checkBorderWidth" type="checkbox" /> Border width consistency</label>
          <label data-tip="Check baseline edge alignment drift."><input id="checkAlignment" type="checkbox" /> Baseline alignment</label>
          <label data-tip="Detect vertical/horizontal whitespace rhythm breaks."><input id="checkWhitespaceRhythm" type="checkbox" /> Whitespace rhythm</label>
          <label data-tip="Find aspect-ratio inconsistencies in peer groups."><input id="checkDimensionRatios" type="checkbox" /> Dimension ratio drift</label>
          <label data-tip="Readability-focused type checks like line-height ratio."><input id="checkTypographyAdvanced" type="checkbox" /> Typography readability rules</label>
          <label data-tip="Advanced layout checks including collision and row/column rhythm."><input id="checkLayoutAdvanced" type="checkbox" /> Advanced layout collision/grid rules</label>
          <label data-tip="Contrast, touch target, labels, heading structure, duplicate IDs."><input id="checkAccessibility" type="checkbox" /> Accessibility + semantics rules</label>
          <label data-tip="Affordance and keyboard behavior checks."><input id="checkInteraction" type="checkbox" /> Interaction affordance rules</label>
          <label data-tip="Detect clipping and overflow content risks."><input id="checkContent" type="checkbox" /> Content clipping rules</label>
          <label data-tip="Maintainability checks for selectors, !important, vars, and entropy."><input id="checkCssQuality" type="checkbox" /> CSS quality + maintainability rules</label>
          <label data-tip="Token scale and diversity checks against configured design scales."><input id="checkDesignTokens" type="checkbox" /> Design token scale + diversity rules</label>
          <label data-tip="Execute custom JSON rules defined below."><input id="checkCustomRules" type="checkbox" /> Custom JSON rules</label>
        </div>
      </section>

      <section class="panel">
        <h2 data-tip-target="true" data-tip="Set per-rule tolerance values that determine what counts as drift.">Thresholds</h2>
        <p class="section-help">
          These values control finding sensitivity. Lower values catch subtle drift; higher values reduce noise. Tune per product and viewport density.
        </p>

        <div class="grid4">
          <label>Padding drift px<input id="paddingPx" type="number" step="0.1" /></label>
          <label>Margin drift px<input id="marginPx" type="number" step="0.1" /></label>
          <label>Font-size drift px<input id="fontSizePx" type="number" step="0.1" /></label>
          <label>Line-height drift px<input id="lineHeightPx" type="number" step="0.1" /></label>
          <label>Letter-spacing drift px<input id="letterSpacingPx" type="number" step="0.1" /></label>
          <label>Border radius drift px<input id="borderRadiusPx" type="number" step="0.1" /></label>
          <label>Border width drift px<input id="borderWidthPx" type="number" step="0.1" /></label>
          <label>Color distance<input id="colorDistance" type="number" step="0.1" /></label>
          <label>Alignment drift px<input id="alignmentPx" type="number" step="0.1" /></label>
          <label>Whitespace drift px<input id="whitespacePx" type="number" step="0.1" /></label>
          <label>Dimension ratio delta<input id="dimensionRatioDelta" type="number" step="0.01" /></label>
          <label>Row height drift px<input id="rowHeightPx" type="number" step="0.1" /></label>
          <label>Column width drift px<input id="columnWidthPx" type="number" step="0.1" /></label>
          <label>Overlap area px2<input id="overlapAreaPx" type="number" step="1" /></label>
          <label>Contrast ratio normal<input id="contrastRatioNormal" type="number" step="0.1" /></label>
          <label>Contrast ratio large<input id="contrastRatioLarge" type="number" step="0.1" /></label>
          <label>Min touch target px<input id="touchTargetMinPx" type="number" step="1" /></label>
          <label>Heading jump tolerance<input id="headingLevelJump" type="number" step="1" /></label>
          <label>Token offscale px<input id="tokenOffscalePx" type="number" step="0.1" /></label>
          <label>Line ratio min<input id="fontLineRatioMin" type="number" step="0.01" /></label>
          <label>Line ratio max<input id="fontLineRatioMax" type="number" step="0.01" /></label>
          <label>Max z-index<input id="maxZIndex" type="number" step="1" /></label>
          <label>Max unique colors<input id="maxUniqueColors" type="number" step="1" /></label>
          <label>Max unique fonts<input id="maxUniqueFonts" type="number" step="1" /></label>
          <label>Max unique radii<input id="maxUniqueRadii" type="number" step="1" /></label>
          <label>Inline style count limit<input id="inlineStyleCount" type="number" step="1" /></label>
          <label>!important limit<input id="importantUsageCount" type="number" step="1" /></label>
          <label>Selector complexity limit<input id="selectorComplexity" type="number" step="0.1" /></label>
          <label>Style entropy limit<input id="styleEntropy" type="number" step="0.01" /></label>
          <label>Min CSS var usage ratio<input id="minVarUsageRatio" type="number" step="0.01" /></label>
          <label>Card title left inset drift px<input id="cardTitleInsetPx" type="number" step="0.1" /></label>
          <label>Dismiss button offset drift px<input id="cardDismissOffsetPx" type="number" step="0.1" /></label>
          <label>Card title/body gap drift px<input id="cardTitleBodyGapPx" type="number" step="0.1" /></label>
          <label>Min title/body size scale<input id="titleBodyScaleMin" type="number" step="0.01" /></label>
          <label>Title font-weight drift tolerance<input id="titleWeightDelta" type="number" step="1" /></label>
        </div>
      </section>

      <section class="panel">
        <h2 data-tip-target="true" data-tip="Reference token scales used for off-scale drift detection.">Design Token Scales</h2>
        <p class="section-help">
          Enter comma-separated numeric values from your design system (spacing/radius/type scales). Scanner flags values that drift from these scales.
        </p>

        <div class="grid3">
          <label data-tip="Spacing scale in px values.">
            Spacing scale
            <textarea id="spacingScale" rows="3"></textarea>
          </label>
          <label data-tip="Border radius scale in px values.">
            Radius scale
            <textarea id="radiusScale" rows="3"></textarea>
          </label>
          <label data-tip="Font size scale in px values.">
            Font scale
            <textarea id="fontScale" rows="3"></textarea>
          </label>
        </div>
      </section>

      <section class="panel">
        <h2 data-tip-target="true" data-tip="Create custom assertions and consistency rules without writing extension code.">Custom Rules Engine</h2>
        <p class="section-help">
          Use the visual Rule Builder for most workflows. Sync to JSON to version-control or bulk edit rules. `assert` validates one value; `consistency` compares matched elements against a baseline.
        </p>

        <div class="checks">
          <label data-tip="Master switch for custom rule execution."><input id="customRulesEnabled" type="checkbox" /> Enable custom rule execution</label>
          <label data-tip="Per-rule cap to prevent very expensive selector matches.">Max matched elements per custom rule<input id="maxMatchedElements" type="number" min="1" /></label>
        </div>

        <div class="rule-builder">
          <h3 data-tip-target="true" data-tip="Build rules visually, then sync to JSON for persistence and portability.">Rule Builder UI</h3>
          <p class="hint">
            Builder supports `assert` and `consistency` rule types with severity, selector, source, property, operator, and tolerance controls.
          </p>

          <div class="grid4">
            <label>Rule id<input id="builderRuleId" type="text" placeholder="btn-min-height" /></label>
            <label>Type
              <select id="builderType">
                <option value="assert">assert</option>
                <option value="consistency">consistency</option>
              </select>
            </label>
            <label>Severity
              <select id="builderSeverity">
                <option value="medium">medium</option>
                <option value="high">high</option>
                <option value="critical">critical</option>
                <option value="low">low</option>
              </select>
            </label>
            <label>Selector<input id="builderSelector" type="text" placeholder="button.primary" /></label>
            <label>Source
              <select id="builderSource">
                <option value="metric">metric</option>
                <option value="style">style</option>
                <option value="attr">attr</option>
                <option value="dataset">dataset</option>
                <option value="rect">rect</option>
                <option value="text">text</option>
              </select>
            </label>
            <label>Property<input id="builderProperty" type="text" placeholder="height / color / aria-label" /></label>
            <label>Operator
              <select id="builderOperator">
                <option value="eq">eq</option>
                <option value="neq">neq</option>
                <option value="gt">gt</option>
                <option value="gte">gte</option>
                <option value="lt">lt</option>
                <option value="lte">lte</option>
                <option value="near">near</option>
                <option value="includes">includes</option>
                <option value="regex">regex</option>
                <option value="oneof">oneof (comma list)</option>
                <option value="exists">exists</option>
                <option value="notEmpty">notEmpty</option>
              </select>
            </label>
            <label>Value<input id="builderValue" type="text" placeholder="44 or primary,secondary" /></label>
            <label>Tolerance (near/consistency)<input id="builderTolerance" type="number" step="0.1" placeholder="2" /></label>
            <label>Baseline (consistency)
              <select id="builderBaseline">
                <option value="median">median</option>
                <option value="mode">mode</option>
              </select>
            </label>
            <label>Message<input id="builderMessage" type="text" placeholder="Buttons should be at least 44px high" /></label>
          </div>

          <div class="builder-actions">
            <button id="builderAddBtn" type="button" class="primary">Add Rule</button>
            <button id="builderClearBtn" type="button">Clear Form</button>
            <button id="builderSyncToJsonBtn" type="button">Sync Builder to JSON</button>
            <button id="builderLoadFromJsonBtn" type="button">Load JSON into Builder</button>
          </div>

          <div id="builderMode" class="hint">Builder mode: Add</div>
          <div id="ruleBuilderList" class="rule-builder-list"></div>
        </div>

        <label data-tip="Raw JSON for custom rules. Builder sync writes to this field.">
          Custom rules JSON
          <textarea id="customRulesJson" rows="10"></textarea>
        </label>
        <p class="hint">
          DSL example:
          <code>[{"id":"btn-min-height","selector":"button","source":"metric","property":"height","operator":"gte","value":44,"severity":"high"}]</code>
        </p>
      </section>

      <section class="panel">
        <h2 data-tip-target="true" data-tip="Configure auto-generated CSS patches derived from scan findings.">Auto Fix Generator</h2>
        <p class="section-help">
          Generated fixes are intended for rapid validation and pull-request starter patches. Keep this enabled to see candidate CSS in popup after each scan, then copy or download the final patch.
        </p>

        <div class="checks">
          <label data-tip="Generate CSS patch suggestions from each scan result."><input id="generateFixes" type="checkbox" /> Generate CSS fixes after each scan</label>
          <label data-tip="Append !important to generated declarations for stronger in-page validation."><input id="fixUseImportant" type="checkbox" /> Use !important in generated CSS</label>
          <label data-tip="Include explanatory comments above each generated selector block."><input id="fixIncludeComments" type="checkbox" /> Include explanatory comments</label>
        </div>

        <div class="grid4">
          <label data-tip="Limit number of selector blocks generated in one scan.">Max generated fix blocks<input id="fixMaxRules" type="number" min="1" /></label>
        </div>
      </section>

      <section class="panel">
        <h2 data-tip-target="true" data-tip="Controls overlay diagnostics visibility and report payload size.">Overlay + Reporting</h2>
        <p class="section-help">
          Configure diagnostics UX and report payload detail. Use lower caps for faster history storage and cleaner issue triage.
        </p>

        <div class="checks">
          <label data-tip="Show highlight boxes for detected issues."><input id="showHighlights" type="checkbox" /> Show highlights</label>
          <label data-tip="Show ruler lines and spacing guides."><input id="showRulers" type="checkbox" /> Show ruler lines</label>
          <label data-tip="Show compact labels above highlighted elements."><input id="showLabels" type="checkbox" /> Show labels</label>
          <label data-tip="Show floating overlay panel with score and top issues."><input id="showPanel" type="checkbox" /> Show panel</label>
        </div>
        <div class="grid4">
          <label data-tip="Max findings rendered in overlay at once.">Max visible findings<input id="maxVisibleFindings" type="number" min="1" /></label>
          <label data-tip="Max findings retained in report payload.">Max findings stored<input id="maxFindings" type="number" min="10" /></label>
          <label data-tip="Initial overlay severity filter when scan finishes.">
            Severity filter
            <select id="severityFilter">
              <option value="all">All</option>
              <option value="critical">Critical</option>
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
          </label>
        </div>
        <div class="checks">
          <label data-tip="Include element HTML snippets in findings."><input id="includeHtmlSnippet" type="checkbox" /> Include HTML snippet in findings</label>
          <label data-tip="Include matched selector/source hints for fix tracing."><input id="includeSourceHints" type="checkbox" /> Include CSS source hints in findings</label>
          <label data-tip="Include computed-style metadata snapshots (larger payload)."><input id="includeComputedSnapshot" type="checkbox" /> Include computed snapshot metadata</label>
        </div>
      </section>

      <footer>
        <button id="saveBtn" class="primary">Save Config</button>
        <button id="resetBtn">Reset to Defaults</button>
        <button id="exportBtn">Export Config JSON</button>
        <button id="importBtn">Import Config JSON</button>
      </footer>

      <p id="status" class="status">Ready.</p>
    </main>

    <script src="../shared/config.js"></script>
    <script src="../shared/utils.js"></script>
    <script src="../shared/ui-elements.js"></script>
    <script src="options.js"></script>
  </body>
</html>
