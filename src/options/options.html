<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>UI Consistency Investigator - Settings</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <main class="wrap">
      <header>
        <p class="eyebrow">Config Studio</p>
        <h1>UI Consistency Investigator</h1>
        <p>
          Configure the full scan engine: selectors, advanced rules, thresholds,
          design-token scales, and custom rule DSL.
        </p>
      </header>

      <section class="panel">
        <h2>Scanning Scope</h2>
        <label>
          Include selectors
          <textarea id="includeSelectors" rows="3"></textarea>
        </label>
        <label>
          Exclude selectors
          <textarea id="excludeSelectors" rows="3"></textarea>
        </label>

        <div class="grid4">
          <label>Min element area (px2)<input id="minElementArea" type="number" min="1" /></label>
          <label>Min group size<input id="minGroupSize" type="number" min="2" /></label>
          <label>Max elements per scan<input id="maxElements" type="number" min="50" /></label>
          <label>Overlap sample limit<input id="overlapSampleLimit" type="number" min="50" /></label>
          <label>Max overlap comparisons<input id="maxOverlapChecks" type="number" min="100" /></label>
        </div>

        <div class="checks">
          <label><input id="traceCSS" type="checkbox" /> Trace CSS source hints</label>
          <label><input id="includeTextNodes" type="checkbox" /> Include text-heavy nodes</label>
        </div>
      </section>

      <section class="panel">
        <h2>Grouping Strategy</h2>
        <div class="checks">
          <label><input id="useTag" type="checkbox" /> Group by tag name</label>
          <label><input id="useRole" type="checkbox" /> Group by ARIA role</label>
          <label><input id="useClassFingerprint" type="checkbox" /> Group by class fingerprint</label>
        </div>
        <label>
          Class fingerprint depth
          <input id="classFingerprintDepth" type="number" min="1" max="5" />
        </label>
      </section>

      <section class="panel">
        <h2>Rule Families</h2>
        <div class="checks multi">
          <label><input id="checkPadding" type="checkbox" /> Padding consistency</label>
          <label><input id="checkMargin" type="checkbox" /> Margin consistency</label>
          <label><input id="checkTypography" type="checkbox" /> Typography consistency</label>
          <label><input id="checkColors" type="checkbox" /> Color consistency</label>
          <label><input id="checkBorderRadius" type="checkbox" /> Border radius consistency</label>
          <label><input id="checkBorderWidth" type="checkbox" /> Border width consistency</label>
          <label><input id="checkAlignment" type="checkbox" /> Baseline alignment</label>
          <label><input id="checkWhitespaceRhythm" type="checkbox" /> Whitespace rhythm</label>
          <label><input id="checkDimensionRatios" type="checkbox" /> Dimension ratio drift</label>
          <label><input id="checkTypographyAdvanced" type="checkbox" /> Typography readability rules</label>
          <label><input id="checkLayoutAdvanced" type="checkbox" /> Advanced layout collision/grid rules</label>
          <label><input id="checkAccessibility" type="checkbox" /> Accessibility + semantics rules</label>
          <label><input id="checkInteraction" type="checkbox" /> Interaction affordance rules</label>
          <label><input id="checkContent" type="checkbox" /> Content clipping rules</label>
          <label><input id="checkCssQuality" type="checkbox" /> CSS quality + maintainability rules</label>
          <label><input id="checkDesignTokens" type="checkbox" /> Design token scale + diversity rules</label>
          <label><input id="checkCustomRules" type="checkbox" /> Custom JSON rules</label>
        </div>
      </section>

      <section class="panel">
        <h2>Thresholds</h2>
        <div class="grid4">
          <label>Padding drift px<input id="paddingPx" type="number" step="0.1" /></label>
          <label>Margin drift px<input id="marginPx" type="number" step="0.1" /></label>
          <label>Font-size drift px<input id="fontSizePx" type="number" step="0.1" /></label>
          <label>Line-height drift px<input id="lineHeightPx" type="number" step="0.1" /></label>
          <label>Letter-spacing drift px<input id="letterSpacingPx" type="number" step="0.1" /></label>
          <label>Border radius drift px<input id="borderRadiusPx" type="number" step="0.1" /></label>
          <label>Border width drift px<input id="borderWidthPx" type="number" step="0.1" /></label>
          <label>Color distance<input id="colorDistance" type="number" step="0.1" /></label>
          <label>Alignment drift px<input id="alignmentPx" type="number" step="0.1" /></label>
          <label>Whitespace drift px<input id="whitespacePx" type="number" step="0.1" /></label>
          <label>Dimension ratio delta<input id="dimensionRatioDelta" type="number" step="0.01" /></label>
          <label>Row height drift px<input id="rowHeightPx" type="number" step="0.1" /></label>
          <label>Column width drift px<input id="columnWidthPx" type="number" step="0.1" /></label>
          <label>Overlap area px2<input id="overlapAreaPx" type="number" step="1" /></label>
          <label>Contrast ratio normal<input id="contrastRatioNormal" type="number" step="0.1" /></label>
          <label>Contrast ratio large<input id="contrastRatioLarge" type="number" step="0.1" /></label>
          <label>Min touch target px<input id="touchTargetMinPx" type="number" step="1" /></label>
          <label>Heading jump tolerance<input id="headingLevelJump" type="number" step="1" /></label>
          <label>Token offscale px<input id="tokenOffscalePx" type="number" step="0.1" /></label>
          <label>Line ratio min<input id="fontLineRatioMin" type="number" step="0.01" /></label>
          <label>Line ratio max<input id="fontLineRatioMax" type="number" step="0.01" /></label>
          <label>Max z-index<input id="maxZIndex" type="number" step="1" /></label>
          <label>Max unique colors<input id="maxUniqueColors" type="number" step="1" /></label>
          <label>Max unique fonts<input id="maxUniqueFonts" type="number" step="1" /></label>
          <label>Max unique radii<input id="maxUniqueRadii" type="number" step="1" /></label>
          <label>Inline style count limit<input id="inlineStyleCount" type="number" step="1" /></label>
          <label>!important limit<input id="importantUsageCount" type="number" step="1" /></label>
          <label>Selector complexity limit<input id="selectorComplexity" type="number" step="0.1" /></label>
          <label>Style entropy limit<input id="styleEntropy" type="number" step="0.01" /></label>
          <label>Min CSS var usage ratio<input id="minVarUsageRatio" type="number" step="0.01" /></label>
        </div>
      </section>

      <section class="panel">
        <h2>Design Token Scales</h2>
        <p class="hint">Comma-separated numeric tokens used for off-scale detection.</p>
        <div class="grid3">
          <label>
            Spacing scale
            <textarea id="spacingScale" rows="3"></textarea>
          </label>
          <label>
            Radius scale
            <textarea id="radiusScale" rows="3"></textarea>
          </label>
          <label>
            Font scale
            <textarea id="fontScale" rows="3"></textarea>
          </label>
        </div>
      </section>

      <section class="panel">
        <h2>Custom Rules Engine</h2>
        <div class="checks">
          <label><input id="customRulesEnabled" type="checkbox" /> Enable custom rule execution</label>
          <label>Max matched elements per custom rule<input id="maxMatchedElements" type="number" min="1" /></label>
        </div>

        <div class="rule-builder">
          <h3>Rule Builder UI</h3>
          <p class="hint">
            Build rules visually, then sync to JSON. Supports <code>assert</code> and <code>consistency</code>.
          </p>

          <div class="grid4">
            <label>Rule id<input id="builderRuleId" type="text" placeholder="btn-min-height" /></label>
            <label>Type
              <select id="builderType">
                <option value="assert">assert</option>
                <option value="consistency">consistency</option>
              </select>
            </label>
            <label>Severity
              <select id="builderSeverity">
                <option value="medium">medium</option>
                <option value="high">high</option>
                <option value="critical">critical</option>
                <option value="low">low</option>
              </select>
            </label>
            <label>Selector<input id="builderSelector" type="text" placeholder="button.primary" /></label>
            <label>Source
              <select id="builderSource">
                <option value="metric">metric</option>
                <option value="style">style</option>
                <option value="attr">attr</option>
                <option value="dataset">dataset</option>
                <option value="rect">rect</option>
                <option value="text">text</option>
              </select>
            </label>
            <label>Property<input id="builderProperty" type="text" placeholder="height / color / aria-label" /></label>
            <label>Operator
              <select id="builderOperator">
                <option value="eq">eq</option>
                <option value="neq">neq</option>
                <option value="gt">gt</option>
                <option value="gte">gte</option>
                <option value="lt">lt</option>
                <option value="lte">lte</option>
                <option value="near">near</option>
                <option value="includes">includes</option>
                <option value="regex">regex</option>
                <option value="oneof">oneof (comma list)</option>
                <option value="exists">exists</option>
                <option value="notEmpty">notEmpty</option>
              </select>
            </label>
            <label>Value<input id="builderValue" type="text" placeholder="44 or button,link" /></label>
            <label>Tolerance (near/consistency)<input id="builderTolerance" type="number" step="0.1" placeholder="2" /></label>
            <label>Baseline (consistency)
              <select id="builderBaseline">
                <option value="median">median</option>
                <option value="mode">mode</option>
              </select>
            </label>
            <label>Message<input id="builderMessage" type="text" placeholder="Buttons should be min 44px height" /></label>
          </div>

          <div class="builder-actions">
            <button id="builderAddBtn" type="button" class="primary">Add Rule</button>
            <button id="builderClearBtn" type="button">Clear Form</button>
            <button id="builderSyncToJsonBtn" type="button">Sync Builder to JSON</button>
            <button id="builderLoadFromJsonBtn" type="button">Load JSON into Builder</button>
          </div>

          <div id="builderMode" class="hint">Builder mode: Add</div>
          <div id="ruleBuilderList" class="rule-builder-list"></div>
        </div>

        <label>
          Custom rules JSON
          <textarea id="customRulesJson" rows="10"></textarea>
        </label>
        <p class="hint">
          DSL supports `assert` and `consistency` rules. Example:
          <code>[{"id":"btn-min-height","selector":"button","source":"metric","property":"height","operator":"gte","value":44,"severity":"high"}]</code>
        </p>
      </section>

      <section class="panel">
        <h2>Overlay + Reporting</h2>
        <div class="checks">
          <label><input id="showHighlights" type="checkbox" /> Show highlights</label>
          <label><input id="showRulers" type="checkbox" /> Show ruler lines</label>
          <label><input id="showLabels" type="checkbox" /> Show labels</label>
          <label><input id="showPanel" type="checkbox" /> Show panel</label>
        </div>
        <div class="grid4">
          <label>Max visible findings<input id="maxVisibleFindings" type="number" min="1" /></label>
          <label>Max findings stored<input id="maxFindings" type="number" min="10" /></label>
          <label>
            Severity filter
            <select id="severityFilter">
              <option value="all">All</option>
              <option value="critical">Critical</option>
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
          </label>
        </div>
        <div class="checks">
          <label><input id="includeHtmlSnippet" type="checkbox" /> Include HTML snippet in findings</label>
          <label><input id="includeSourceHints" type="checkbox" /> Include CSS source hints in findings</label>
          <label><input id="includeComputedSnapshot" type="checkbox" /> Include computed snapshot metadata</label>
        </div>
      </section>

      <footer>
        <button id="saveBtn" class="primary">Save Config</button>
        <button id="resetBtn">Reset to Defaults</button>
        <button id="exportBtn">Export Config JSON</button>
        <button id="importBtn">Import Config JSON</button>
      </footer>

      <p id="status" class="status">Ready.</p>
    </main>

    <script src="../shared/config.js"></script>
    <script src="../shared/utils.js"></script>
    <script src="options.js"></script>
  </body>
</html>
